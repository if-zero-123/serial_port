# 串口仿真调试工程

本项目基于 Keil MDK（uVision）和 STM32 标准外设库，实现通过 **虚拟串口** 输出 `printf` 信息，用于在 **仿真模式** 下调试串口相关功能。

## 功能简介

- 使用 Keil 的 **仿真/软件调试** 功能，不依赖真实串口硬件即可调试
- 将 `printf` 重定向到 `USART1`
- 通过虚拟串口软件建立串口通道，在 PC 端串口调试助手查看打印信息

## 使用步骤

1. **下载源码**  
   将本仓库完整下载到本地（Git clone 或直接解压 ZIP）。

2. **打开 Keil 工程**  
   使用 Keil MDK 打开根目录下的工程文件：`工程模板.uvproj` 或 `工程模板.uvprojx`。

3. **配置为软件仿真调试**  
   在 Keil 中依次打开：`Options for Target` → `Debug`，选择合适的 **Simulator** / **软件仿真**（而不是 J-LINK、ST-LINK 等硬件仿真器）。

4. **配置 ini 调试脚本（debug.ini）**  
   在同一 `Debug` 选项卡中，勾选 **Initialization File**，选择本工程提供的 ini 脚本：`debug.ini`，用于在仿真启动时将 Keil 模拟串口映射到 PC 端的虚拟串口。

5. **打开虚拟串口软件并创建虚拟串口**  
   - 打开你使用的虚拟串口工具（如 VSPD、com0com 等）  
   - 新建一对互联的虚拟串口（如 COM10–COM11），记住其中一个供串口调试助手使用

6. **打开串口调试助手**  
   在 PC 上打开串口调试工具（如 SSCOM、SecureCRT、Termite 等）：
   - 选择前一步创建的虚拟串口号（如 COM10）
   - 波特率与工程配置一致（例如 115200）
   - 数据位、停止位、校验位与工程中 `USART` 初始化配置保持一致

7. **进入 Keil 调试并运行**  
   - 在 Keil 中点击 **Start/Stop Debug Session** 进入调试模式  
   - 点击 **Run**（或按 F5）运行程序  
   - 此时在串口调试助手中，即可看到通过 `printf` 输出的日志信息。

## 注意事项

- 若中文显示为乱码，请确认：  
  - 源码文件编码（UTF-8 / GBK 等）  
  - 串口调试助手的接收编码设置保持一致。
- 若没有看到任何输出，请检查：  
   - 是否正确加载了 `debug.ini` 调试脚本；  
  - 虚拟串口工具是否已成功创建串口，并且未被其他程序占用；  
  - 串口号和波特率设置是否与代码中配置一致。

## debug.ini 说明

根目录下提供的 `debug.ini` 内容如下：

```ini
MODE COM1 115200,0,8,1
ASSIGN COM1 <S1IN> S1OUT
```

- `MODE COM1 115200,0,8,1`：在 Keil 仿真器中配置一个名为 `COM1` 的串口，波特率 `115200`，无校验（0）、数据位 8、停止位 1。  
- `ASSIGN COM1 <S1IN> S1OUT`：将 Keil 的串口窗口 `Serial #1` 的输入/输出（`S1IN` / `S1OUT`）绑定到 `COM1`，这样仿真时就能通过虚拟串口与外部串口工具通信。